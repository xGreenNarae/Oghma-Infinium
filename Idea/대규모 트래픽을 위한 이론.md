#### 지표 수집과 모니터링  
측정할 수 없으면 개선할 수 없다.  
어느 구간에서 어떤 문제가 발생하는지 파악할 수 있도록 로그를 잘 기록하고, 지표를 수집하여 지속적으로 모니터링하는 것이 1번이다.  

---  

#### 성능 테스트  
가상의 대규모 트래픽을 발생시키기 위한 테스트를 할 때, 사용되는 가상 **클라이언트의 힘이 부족할 수 있음**에 주의.  

---  

#### 로드밸런싱  
클라이언트 사이드에서도 로드밸런싱을 생각해 볼 수 있다. 다만 서버에 대한 정보를 관리하려면 매번 배포를 다시해야한다는것이 현재로써는 가장 큰 문제점이다.  
Nginx, HAProxy 등이 L7, L4 소프트웨어 로드밸런서로 사용될 수 있다. 서버에 대한 헬스체크를 스스로하면서 관리한다. 하드웨어 로드밸런서를 사용할 수도 있다.  

전략은 기본적으로 라운드로빈을 사용할 수 있는데, 조금 더 신경써본다면 각 요청에 대한 큐를 운용할 수 있겠다.  
weighted round robin 이라는 알고리즘은, 미리(pre) 서버 별 가중치를 설정해두어 요청 비중을 다르게 가져가는 것이다.  
latency 를 측정하여 가중치를 동적으로 조정하는 dynamic weighted round robin 이라는 방식도 있다고 하는데, 어떤 의미를 갖는지 아직 모르겠음.  

least connections load balancing은 새로운 요청이 들어올 때마다 각 서버의 미결 요청 수를 기준으로 우선순위를 지정하는 방식이다. 구현이 간단하고 좋은 선택이라고 함.  

여기서 문제는 "요청이 버려지는 것" 만큼 중요한 로드밸런서의 목적은 "대기시간 최적화" 라는 것인데, 이를 위해서 "peak exponentially weighted moving average" (PEWMA) 라는 알고리즘을 사용할 수 있다고 함. 추가적인 복잡성을 제공하고, 항상 least connections 방식에 비해 좋은것은 아니라고..  

대략 Nginx 설정에는 Round Robin, Least Connections 등을 지원하고 있는 것은 확인했음.  
AWS 에서는 ELB라는 이름으로 서비스를 제공한다.  

---  

#### Service Discovery  
서비스 진입점을 클라이언트에게 알려주는 것을 동적으로 관리할 필요가 있다. 진입점을 알려준다는 것은 예를들어 DNS가 이런 역할을 한다고 볼 수 있는데, 서버 목록과 상태가 변경되면 이런것들을 동적으로 관리할 기술이 필요하다.  
이것을 Coordinator 라고 함.  
Zookeeper, Etcd, Consul, Eureka 등의 제품이 있다.  
이외에도 REST API를 이용하여 직접구현, Pub/Sub 방식, Watcher 등을 이용할 수도 있고 방법은 다양하다.  

Zookeeper
Quorum 쿼럼 : 과반수 서버로 이루어진 그룹.  
보통 3대 이상을 두고, 데이터 동기화를 이루어지게 한다.  

Feature Flag(Feature Toggle)  
기능을 동적으로 켜고 끌수 있는 방식. 배포가 오래걸린다면, 유용하다.  

---  

#### Circuit Breaker  
회로차단기. Fast Fail Back.  
아마도 MSA 환경에서, 처리 과정의 중간에서 장애가 발생한다면 필수적이지 않은 API 들을 차단하여 불필요한 부하와 처리지연을 제거하기 위함.  

Close : 정상적인 API 호출이 되는 상태  
Open : 일정시간 동안 API 호출을 바로 실패하는 상태  
Half Open : Open인 상태에서 일정시간이 지나면 상태를 다시 확인해보기 위해서 API호출을 시도해보는 상태. 성공여부에 따라 Open/Close 상태를 변경한다.  

직접 구현할 수 있음.  
Python: Pybreaker, Aiobreaker  
Java 에서는 Resilience4j 가 현재 많이 사용 중이라고 한다.  

---  



